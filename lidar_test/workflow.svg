<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 699.04296875 1124.859375" style="max-width: 699.04296875px;" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-svg-1749489677094-u9btp3qjj"><style>#mermaid-svg-1749489677094-u9btp3qjj{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .error-icon{fill:#5a1d1d;}#mermaid-svg-1749489677094-u9btp3qjj .error-text{fill:#f85149;stroke:#f85149;}#mermaid-svg-1749489677094-u9btp3qjj .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1749489677094-u9btp3qjj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1749489677094-u9btp3qjj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1749489677094-u9btp3qjj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1749489677094-u9btp3qjj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1749489677094-u9btp3qjj .marker{fill:#cccccc;stroke:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .marker.cross{stroke:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1749489677094-u9btp3qjj .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .cluster-label text{fill:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .cluster-label span,#mermaid-svg-1749489677094-u9btp3qjj p{color:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .label text,#mermaid-svg-1749489677094-u9btp3qjj span,#mermaid-svg-1749489677094-u9btp3qjj p{fill:#cccccc;color:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .node rect,#mermaid-svg-1749489677094-u9btp3qjj .node circle,#mermaid-svg-1749489677094-u9btp3qjj .node ellipse,#mermaid-svg-1749489677094-u9btp3qjj .node polygon,#mermaid-svg-1749489677094-u9btp3qjj .node path{fill:#1f1f1f;stroke:#3c3c3c;stroke-width:1px;}#mermaid-svg-1749489677094-u9btp3qjj .flowchart-label text{text-anchor:middle;}#mermaid-svg-1749489677094-u9btp3qjj .node .label{text-align:center;}#mermaid-svg-1749489677094-u9btp3qjj .node.clickable{cursor:pointer;}#mermaid-svg-1749489677094-u9btp3qjj .arrowheadPath{fill:#e0e0e0;}#mermaid-svg-1749489677094-u9btp3qjj .edgePath .path{stroke:#cccccc;stroke-width:2.0px;}#mermaid-svg-1749489677094-u9btp3qjj .flowchart-link{stroke:#cccccc;fill:none;}#mermaid-svg-1749489677094-u9btp3qjj .edgeLabel{background-color:#1f1f1f99;text-align:center;}#mermaid-svg-1749489677094-u9btp3qjj .edgeLabel rect{opacity:0.5;background-color:#1f1f1f99;fill:#1f1f1f99;}#mermaid-svg-1749489677094-u9btp3qjj .labelBkg{background-color:rgba(31, 31, 31, 0.5);}#mermaid-svg-1749489677094-u9btp3qjj .cluster rect{fill:#3a3d41;stroke:#313131;stroke-width:1px;}#mermaid-svg-1749489677094-u9btp3qjj .cluster text{fill:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj .cluster span,#mermaid-svg-1749489677094-u9btp3qjj p{color:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:#616161;border:1px solid #0078d4;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1749489677094-u9btp3qjj .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#cccccc;}#mermaid-svg-1749489677094-u9btp3qjj :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="6" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="mermaid-svg-1749489677094-u9btp3qjj_flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-A LE-B" id="L-A-B-0" d="M292.125,39L292.125,43.167C292.125,47.333,292.125,55.667,292.125,63.117C292.125,70.567,292.125,77.133,292.125,80.417L292.125,83.7"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-C" id="L-B-C-0" d="M227.224,123L211.317,127.167C195.41,131.333,163.595,139.667,147.688,147.533C131.781,155.4,131.781,162.8,131.781,166.5L131.781,170.2"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-D" id="L-B-D-0" d="M357.026,123L372.933,127.167C388.84,131.333,420.655,139.667,436.562,147.117C452.469,154.567,452.469,161.133,452.469,164.417L452.469,167.7"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D LE-E" id="L-D-E-0" d="M452.469,236L452.469,240.167C452.469,244.333,452.469,252.667,452.535,260.2C452.601,267.734,452.733,274.467,452.799,277.834L452.865,281.201"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-F" id="L-E-F-0" d="M412.885,406.276L400.297,418.623C387.708,430.97,362.532,455.665,349.944,478.595C337.355,501.526,337.355,522.693,337.355,543.859C337.355,565.026,337.355,586.193,337.355,607.776C337.355,629.359,337.355,651.359,337.355,671.776C337.355,692.193,337.355,711.026,337.355,724.143C337.355,737.259,337.355,744.659,337.355,748.359L337.355,752.059"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E LE-G" id="L-E-G-0" d="M493.053,406.276L505.474,418.623C517.896,430.97,542.739,455.665,555.16,472.879C567.582,490.093,567.582,499.826,567.582,504.693L567.582,509.559"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-G LE-H" id="L-G-H-0" d="M567.582,572.859L567.582,578.609C567.582,584.359,567.582,595.859,567.582,606.476C567.582,617.093,567.582,626.826,567.582,631.693L567.582,636.559"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-H LE-I" id="L-H-I-0" d="M567.582,704.859L567.582,709.026C567.582,713.193,567.582,721.526,567.582,728.976C567.582,736.426,567.582,742.993,567.582,746.276L567.582,749.559"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-F LE-J" id="L-F-J-0" d="M337.355,815.359L337.355,819.943C337.355,824.526,337.355,833.693,347.31,842.124C357.264,850.556,377.173,858.252,387.128,862.1L397.082,865.948"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-I LE-J" id="L-I-J-0" d="M567.582,817.859L567.582,822.026C567.582,826.193,567.582,834.526,557.628,842.541C547.673,850.556,527.764,858.252,517.81,862.1L507.855,865.948"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-J LE-K" id="L-J-K-0" d="M452.469,906.859L452.469,911.026C452.469,915.193,452.469,923.526,452.469,930.976C452.469,938.426,452.469,944.993,452.469,948.276L452.469,951.559"/><path marker-end="url(#mermaid-svg-1749489677094-u9btp3qjj_flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-K LE-L" id="L-K-L-0" d="M452.469,1019.859L452.469,1024.026C452.469,1028.193,452.469,1036.526,452.469,1043.976C452.469,1051.426,452.469,1057.993,452.469,1061.276L452.469,1064.559"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(337.35546875, 607.359375)" class="edgeLabel"><g transform="translate(-39.2734375, -9.5)" class="label"><foreignObject height="19" width="78.546875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Host Policy</span></div></foreignObject></g></g><g transform="translate(567.58203125, 480.359375)" class="edgeLabel"><g transform="translate(-68.828125, -9.5)" class="label"><foreignObject height="19" width="137.65625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel">Organization Policy</span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(292.125, 19.5)" id="flowchart-A-367" class="node default default flowchart-label"><rect height="39" width="88.859375" y="-19.5" x="-44.4296875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-36.9296875, -12)" style="" class="label"><rect/><foreignObject height="24" width="73.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">創建Policy</span></div></foreignObject></g></g><g transform="translate(292.125, 106)" id="flowchart-B-368" class="node default default flowchart-label"><rect height="34" width="207.375" y="-17" x="-103.6875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-96.1875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="192.375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PolicyCreatedDomainEvent</span></div></foreignObject></g></g><g transform="translate(131.78125, 204.5)" id="flowchart-C-370" class="node default default flowchart-label"><rect height="58" width="263.5625" y="-29" x="-131.78125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-124.28125, -21.5)" style="" class="label"><rect/><foreignObject height="43" width="248.5625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">PolicyCreatedDomainEventHandler<br />(發送control event)</span></div></foreignObject></g></g><g transform="translate(452.46875, 204.5)" id="flowchart-D-372" class="node default default flowchart-label"><rect height="63" width="277.8125" y="-31.5" x="-138.90625" ry="0" rx="0" style="fill:#98FB98;" class="basic label-container"/><g transform="translate(-131.40625, -24)" style="" class="label"><rect/><foreignObject height="48" width="262.8125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">新的ClearCacheDomainEventHandler<br />(清除cache)</span></div></foreignObject></g></g><g transform="translate(452.46875, 365.9296875)" id="flowchart-E-374" class="node default default flowchart-label"><polygon style="" transform="translate(-79.9296875,79.9296875)" class="label-container" points="79.9296875,0 159.859375,-79.9296875 79.9296875,-159.859375 0,-79.9296875"/><g transform="translate(-52.9296875, -12)" style="" class="label"><rect/><foreignObject height="24" width="105.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Policy類型判斷</span></div></foreignObject></g></g><g transform="translate(337.35546875, 786.359375)" id="flowchart-F-376" class="node default default flowchart-label"><rect height="58" width="172.296875" y="-29" x="-86.1484375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-78.6484375, -21.5)" style="" class="label"><rect/><foreignObject height="43" width="157.296875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">清除特定Host的cache<br />key: policy:hostId:xxx</span></div></foreignObject></g></g><g transform="translate(567.58203125, 543.859375)" id="flowchart-G-378" class="node default default flowchart-label"><rect height="58" width="230.921875" y="-29" x="-115.4609375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-107.9609375, -21.5)" style="" class="label"><rect/><foreignObject height="43" width="215.921875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">清除Organization的cache<br />key: policy:organizationId:xxx</span></div></foreignObject></g></g><g transform="translate(567.58203125, 673.359375)" id="flowchart-H-380" class="node default default flowchart-label"><rect height="63" width="169.984375" y="-31.5" x="-84.9921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-77.4921875, -24)" style="" class="label"><rect/><foreignObject height="48" width="154.984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">查找該Organization下<br />所有Host</span></div></foreignObject></g></g><g transform="translate(567.58203125, 786.359375)" id="flowchart-I-382" class="node default default flowchart-label"><rect height="63" width="188.15625" y="-31.5" x="-94.078125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-86.578125, -24)" style="" class="label"><rect/><foreignObject height="48" width="173.15625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">清除所有Host的cache<br />防止返回舊的root policy</span></div></foreignObject></g></g><g transform="translate(452.46875, 887.359375)" id="flowchart-J-384" class="node default default flowchart-label"><rect height="39" width="122.375" y="-19.5" x="-61.1875" ry="0" rx="0" style="fill:#98FB98;" class="basic label-container"/><g transform="translate(-53.6875, -12)" style="" class="label"><rect/><foreignObject height="24" width="107.375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Cache清除完成</span></div></foreignObject></g></g><g transform="translate(452.46875, 988.359375)" id="flowchart-K-388" class="node default default flowchart-label"><rect height="63" width="176.9375" y="-31.5" x="-88.46875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-80.96875, -24)" style="" class="label"><rect/><foreignObject height="48" width="161.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">下次GetPolicyByHostId<br />會重新從資料庫查詢</span></div></foreignObject></g></g><g transform="translate(452.46875, 1089.359375)" id="flowchart-L-390" class="node default default flowchart-label"><rect height="39" width="136.859375" y="-19.5" x="-68.4296875" ry="0" rx="0" style="fill:#98FB98;" class="basic label-container"/><g transform="translate(-60.9296875, -12)" style="" class="label"><rect/><foreignObject height="24" width="121.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">返回正確的Policy</span></div></foreignObject></g></g></g></g></g></svg>