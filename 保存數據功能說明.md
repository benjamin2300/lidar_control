# LiDAR 掃描數據保存功能說明

## 功能概述

新增了掃描數據自動收集和保存功能，可以將掃描過程中收到的所有frame數據保存為JSON格式。

## 網路配置說明

系統使用 **`etherInform.json`** 作為網路配置文件，與原有的 LiDAR 控制程序保持一致：

```json
{
    "localIP": "192.168.2.194",   // 本機IP地址
    "remoteIP": "192.168.2.10",   // LiDAR設備IP地址
    "port": 8880,                 // 控制端口
    "dataPort": 8881              // 數據接收端口
}
```

- **控制端口 (port)**: 8880 (用於發送指令)
- **數據端口 (dataPort)**: 8881 (用於接收掃描數據)

**注意**: 如果 `etherInform.json` 中沒有 `dataPort` 字段，系統將自動使用默認值 8881。

## 使用方法

### 1. 開始掃描並收集數據
- 點擊 **"開始掃描"** 按鈕
- 系統會自動：
  - 清空之前收集的掃描數據
  - 開始收集新的frame數據
  - 發送掃描指令給LiDAR設備

### 2. 停止掃描
- 點擊 **"停止掃描"** 按鈕
- 系統會：
  - 停止數據收集
  - 如果有收集到數據，啟用 **"保存數據"** 按鈕

### 3. 保存數據
- 點擊 **"保存數據"** 按鈕
- 系統會將收集的數據保存為JSON格式
- 文件會保存在 `data/raw/` 目錄下
- 文件名格式：`scan_YYYYMMDD_HHMMSS.json`

## 數據格式說明

保存的JSON文件包含以下信息：

```json
{
  "timestamp": "2025-06-01T16:53:13.124058",  // 保存時間
  "total_frames": 3,                          // 總frame數量
  "frames": [                                 // frame數據陣列
    {
      "frame_index": 0,                       // frame索引
      "stats": {                              // 統計信息
        "point_count": 100,                   // 點數量
        "min_distance": 0.02,                 // 最小距離
        "max_distance": 9.98,                 // 最大距離
        "avg_distance": 4.80                  // 平均距離
      },
      "points": [                             // 點雲數據
        [x, y, z, distance, x_angle, y_angle], // 每個點的6維數據
        // ... 更多點
      ]
    }
    // ... 更多frame
  ]
}
```

## 數據說明

每個點包含6個維度的數據：
- `x, y, z`: 3D座標 (單位：米)
- `distance`: 距離值 (單位：米)
- `x_angle`: X軸角度 (單位：度)
- `y_angle`: Y軸角度 (單位：度)

## 注意事項

1. **自動清空**: 每次開始掃描時會自動清空之前收集的數據
2. **實時收集**: 只有在掃描過程中收到的frame數據才會被收集
3. **一次性保存**: 保存數據後按鈕會被禁用，需要重新掃描才能再次保存
4. **文件覆蓋**: 如果文件名相同會被覆蓋，建議及時備份重要數據

## 技術實現

- 數據收集在 `LidarDataProcessor.start_scan_data_collection()` 中開始
- Frame數據在 `assemble_point_cloud()` 方法中自動添加到收集列表
- 保存功能在 `save_scan_data_as_json()` 方法中實現
- GUI按鈕狀態會根據掃描和數據狀態自動更新 