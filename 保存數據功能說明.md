# LiDAR 點雲數據保存功能說明

## 功能概述

新版本的LiDAR控制系統提供了**暫停保存當前點雲**和**載入點雲數據**的功能，取代了之前保存所有掃描數據的方式。這樣可以讓用戶更精確地控制要保存的數據。

## 網路配置說明

系統使用 **`etherInform.json`** 作為網路配置文件，與原有的 LiDAR 控制程序保持一致：

```json
{
    "localIP": "192.168.2.194",   // 本機IP地址
    "remoteIP": "192.168.2.10",   // LiDAR設備IP地址
    "port": 8880,                 // 控制端口
    "dataPort": 8881              // 數據接收端口
}
```

- **控制端口 (port)**: 8880 (用於發送指令)
- **數據端口 (dataPort)**: 8881 (用於接收掃描數據)

**注意**: 如果 `etherInform.json` 中沒有 `dataPort` 字段，系統將自動使用默認值 8881。

## 使用方法

### 1. 開始掃描
- 點擊 **"開始掃描"** 按鈕
- 系統會開始實時掃描並顯示點雲數據
- 此時可以看到實時更新的3D點雲視圖

### 2. 暫停掃描查看當前點雲
- 在掃描過程中，當看到想要保存的點雲數據時
- 點擊 **"暫停"** 按鈕暫停掃描
- 此時點雲視圖會停止更新，顯示當前暫停時刻的點雲

### 3. 保存當前點雲數據
- 只有在暫停狀態下才能保存當前點雲
- 點擊 **"保存當前點雲"** 按鈕
- 系統會將當前顯示的點雲數據保存為JSON格式
- 文件會保存在 `data/saved_clouds/` 目錄下
- 文件名格式：`point_cloud_YYYYMMDD_HHMMSS.json`

### 4. 恢復或停止掃描
- 保存完成後可以點擊 **"恢復"** 繼續掃描
- 或者點擊 **"停止掃描"** 結束當前掃描任務

### 5. 載入之前保存的點雲數據
- 在掃描停止狀態下，點擊 **"載入點雲"** 按鈕
- 選擇要載入的點雲文件（.json格式）
- 載入後的點雲會在3D視圖中顯示
- 載入的點雲會覆蓋當前的掃描數據顯示

### 6. 清除載入的點雲
- 如果想要清除載入的點雲數據，點擊 **"清除載入"** 按鈕
- 這樣可以恢復顯示實時掃描的數據

## 數據格式說明

保存的JSON文件包含以下信息：

```json
{
  "timestamp": "2025-01-15T14:30:25.123456",  // 保存時間
  "point_count": 180000,                      // 點雲數量
  "data_type": "current_point_cloud",         // 數據類型標識
  "points": [                                 // 點雲數據陣列
    [x, y, z, distance, x_angle, y_angle],    // 每個點的6維數據
    // ... 更多點
  ]
}
```

## 數據說明

每個點包含6個維度的數據：
- `x, y, z`: 3D座標 (單位：米)
- `distance`: 距離值 (單位：米)  
- `x_angle`: X軸角度 (單位：度)
- `y_angle`: Y軸角度 (單位：度)

## 按鈕狀態說明

### 掃描狀態下的按鈕行為：
- **開始掃描**: 禁用
- **暫停**: 啟用
- **恢復**: 禁用  
- **停止掃描**: 啟用
- **保存當前點雲**: 禁用
- **載入點雲**: 禁用
- **清除載入**: 禁用

### 暫停狀態下的按鈕行為：
- **開始掃描**: 禁用
- **暫停**: 禁用
- **恢復**: 啟用
- **停止掃描**: 啟用
- **保存當前點雲**: 啟用 ✨
- **載入點雲**: 禁用
- **清除載入**: 禁用

### 停止狀態下的按鈕行為：
- **開始掃描**: 啟用
- **暫停**: 禁用
- **恢復**: 禁用
- **停止掃描**: 禁用
- **保存當前點雲**: 禁用
- **載入點雲**: 啟用 ✨
- **清除載入**: 根據是否有載入數據決定

## 注意事項

1. **必須暫停才能保存**: 只有在暫停狀態下才能保存當前點雲數據
2. **實時查看**: 可以在掃描過程中實時查看點雲，找到理想的數據後再暫停保存
3. **載入覆蓋**: 載入的點雲數據會覆蓋當前顯示，直到清除載入或重新開始掃描
4. **文件格式**: 只支持JSON格式的點雲文件載入
5. **數據完整性**: 保存的是完整的6維點雲數據，包含位置和角度信息

## 技術實現

- 暫停功能在 `LidarDataProcessor.pause_scanning()` 中實現
- 保存功能在 `save_current_point_cloud()` 方法中實現
- 載入功能在 `load_point_cloud()` 方法中實現
- 顯示邏輯在 `get_display_point_cloud()` 方法中統一處理
- GUI按鈕狀態會根據掃描狀態自動更新 